<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Simple C++ Container</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="A blog about myself" />
    <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="/2019/10/06/simple-container/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Michele Mischitelli's blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Simple C++ Container" />
    <meta property="og:description" content="When I used to develop C# UWP application, MVVM was the architectural pattern of choice of many developers and maybe it still is. A recurring concept in the MVVM pattern is the dependency injection, a 25-dollar term for a 5-cent concept. Dependency injection is a pretty common design pattern where" />
    <meta property="og:url" content="/2019/10/06/simple-container/" />
    <meta property="og:image" content="/assets/images/posts/simple-container.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2019-10-06T12:00:00+02:00" />
    <meta property="article:modified_time" content="2019-10-06T12:00:00+02:00" />
    <meta property="article:tag" content="Cpp" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Simple C++ Container" />
    <meta name="twitter:description" content="When I used to develop C# UWP application, MVVM was the architectural pattern of choice of many developers and maybe it still is. A recurring concept in the MVVM pattern is the dependency injection, a 25-dollar term for a 5-cent concept. Dependency injection is a pretty common design pattern where" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image" content="/assets/images/posts/simple-container.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Michele Mischitelli's blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Cpp" />
    <meta name="twitter:site" content="@michelemischit1" />
    <meta name="twitter:creator" content="@michelemischit1" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Michele Mischitelli's blog",
        "logo": "/assets/images/blog-logo.png"
    },
    "url": "/2019/10/06/simple-container/",
    "image": {
        "@type": "ImageObject",
        "url": "/assets/images/posts/simple-container.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/2019/10/06/simple-container/"
    },
    "description": "When I used to develop C# UWP application, MVVM was the architectural pattern of choice of many developers and maybe it still is. A recurring concept in the MVVM pattern is the dependency injection, a 25-dollar term for a 5-cent concept. Dependency injection is a pretty common design pattern where"
}
    </script>

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Simple C++ Container" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/"><img src="/assets/images/blog-logo.png" alt="Michele Mischitelli's blog" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-portfolio" role="menuitem"><a href="/portfolio/">Portfolio</a></li>
    <li class="nav-talks" role="menuitem"><a href="/talks/">Talks</a></li>
    <li class="nav-thesis" role="menuitem"><a href="/thesis/">Thesis</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/michelemischit1" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-cpp ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 6 October 2019"> 6 October 2019</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/cpp/'>CPP</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Simple C++ Container</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/posts/simple-container.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>When I used to develop C# UWP application, MVVM was the architectural pattern of choice of many developers and maybe it still is.</p>

<p>A recurring concept in the MVVM pattern is the dependency injection, <a href="https://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html"><em>a 25-dollar term for a 5-cent concept</em></a>. Dependency injection is a pretty common design pattern where classes are not allowed to create instances of external services they need to accomplish tasks. Instead, those dependencies are provided at runtime, usually in the constructor.</p>

<p>But I don’t want to spend too much time explaining what DI is. Instead, I’m more interested in talking about the <em>container</em>, which is a fundamental component of it.</p>

<h2 id="what-functionality-does-a-di-container-provide">What functionality does a DI container provide?</h2>

<p>You can think about the container as a class whose purpose is to decouple instantiation from usage. Objects creation is no longer performed by invoking <em>new</em>; instead, it depends on some policy the developer specified.</p>

<p>When does it happen? During the registration phase, usually right after the container is created. Why is this registration even needed? Because, apart from the <em>lifetime policy</em> I just mentioned, developers are also able to specify which implementation will get resolved when we ask for a particular interface.</p>

<p>At this point, you’re probably looking at this article puzzled and confused. Let me shed some light on the subject and make things more clear.</p>

<h2 id="ladies-and-gents-the-native-container">Ladies and gents, the Native Container</h2>

<p>Without further ado, let’s see how it all works.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">container</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">NativeContainer</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">container</span><span class="o">-&gt;</span><span class="n">RegisterType</span><span class="o">&lt;</span><span class="n">SimpleInterface</span><span class="p">,</span> <span class="n">SimpleType</span><span class="p">,</span> <span class="n">ContainerControlledManager</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div></div>

<p>On the first line, we simply create an instance of some class named <code class="highlighter-rouge">NativeContainer</code>. nothing fancy. On the next line, we’re invoking a templated method accepting three types:</p>
<ul>
  <li><code class="highlighter-rouge">SimpleInterface</code>: the interface that the next argument must implement</li>
  <li><code class="highlighter-rouge">SimpleType</code>: some class which implements the previous interface</li>
  <li><code class="highlighter-rouge">ContainerControlledManager</code>: the lifetime manager I’ve mentioned in the previous paragraph</li>
</ul>

<p>Before diving deeper into the inner workings of the Native Container, let me explain what is happening here.</p>

<p>By invoking <code class="highlighter-rouge">RegisterType</code>, we’re telling the container that whenever we require an instance of <code class="highlighter-rouge">SimpleInterface</code>, it should be <em>resolved</em> by instantiating an object of <code class="highlighter-rouge">SimpleType</code>. How this object is created and how its memory is managed depends on which <em>lifetime manager</em> we’re specifying. Note that, at this point, no instance is actually created!</p>

<p>Later on, to retrieve a <code class="highlighter-rouge">SimpleType</code> instance, we simply call:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">auto</span> <span class="n">object</span> <span class="o">=</span> <span class="n">container</span><span class="o">-&gt;</span><span class="n">Resolve</span><span class="o">&lt;</span><span class="n">SimpleInterface</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div></div>

<p>Do you see a call to the <code class="highlighter-rouge">new</code> operator? Are we specifying <code class="highlighter-rouge">SimpleType</code> anywhere in the above line? Exactly, both questions have the same answer: nope. The Native Container is hiding the actual type of our the returned instance behind an interface and the caller has no simple way of knowing it. Moreover, as far as the caller is concerned, we’re not calling <code class="highlighter-rouge">new</code> anywhere: this allows us to execute some custom logic at creation time; it will become more evident in the future when I’ll talk about dependency resolution, but it is something for another post.</p>

<h2 id="creating-a-resolvable-class">Creating a resolvable class</h2>

<p>As mentioned above, any type we’d like to register in the container must implement an interface that abstracts (or hides) the actual implementation. But, in turn, this interface must also derive from another interface, something specific that is tied to how the Native Container works.</p>

<p>I named this <code class="highlighter-rouge">IResolvableType</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">IResolvableType</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">IResolvableType</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="k">virtual</span> <span class="n">ClassUniqueId</span> <span class="n">GetTypeId</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This interface provides two core functionalities: it declares a virtual method that, when overridden by derived classes, returns some kind of <em>unique identifier</em> that can be useful at runtime to perform type checking cheaply. This is not meant to be as comprehensive as RTTI, nor is really necessary, but for the sake of completeness, it’s worth mentioning.</p>

<p>The other handy functionality lies in the fact that all the resolvable interfaces must derive from it: we can thus perform compile-time checks to ensure that only compatible types and interfaces are being registered in the container.</p>

<p>Unfortunately, implementing the <code class="highlighter-rouge">IResolvableType</code> is not enough to guarantee what we’re trying to achieve. Here’s the complete declaration of a very simple interface that can be registered in the Native Container:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PrinterInterface</span> <span class="o">:</span> <span class="k">public</span> <span class="n">IResolvableType</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">char</span> <span class="n">m_kTypeId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">SameAs</span><span class="p">()</span> <span class="p">{</span> 
    <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">m_kTypeId</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">T</span><span class="o">::</span><span class="n">m_kTypeId</span><span class="p">)</span> <span class="p">{</span> 
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> 
    <span class="p">}</span> 
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> 
  <span class="p">}</span>

  <span class="k">static</span> <span class="k">constexpr</span> <span class="n">ClassUniqueId</span> <span class="n">GetStaticTypeId</span><span class="p">()</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">ClassUniqueId</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_kTypeId</span><span class="p">);</span> 
  <span class="p">}</span>

  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">ClassUniqueId</span> <span class="n">GetTypeId</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="n">GetStaticTypeId</span><span class="p">();</span> 
  <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">PrintSomething</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>The whole runtime type comparison concept is taken straight from <a href="/2019/07/17/templated-properties//#generic-properties">the templated properties</a> article and evolved a bit to be <code class="highlighter-rouge">constexpr</code>. Since I’m not fond of duplicating code and consider the whole type-checking bits to be quite distracting, I prefer putting them in a handy macro:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define ResolvableMagic(ClassType) \
public: \
	static constexpr char m_kTypeId = 0; \
	template&lt;typename T&gt; \
	static constexpr bool SameAs() { if constexpr (&amp;m_kTypeId == &amp;T::m_kTypeId) { return true; } return false; } \
	static constexpr ClassUniqueId GetStaticTypeId() { return static_cast&lt;ClassUniqueId&gt;(&amp;m_kTypeId); } \
	[[nodiscard]] ClassUniqueId GetTypeId() const override { return GetStaticTypeId(); } \
private:\
</span></code></pre></div></div>

<p>This allows me to finally declare the interface and the implementation as you would expect:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PrinterInterface</span> <span class="o">:</span> <span class="k">public</span> <span class="n">IResolvableType</span>
<span class="p">{</span>
  <span class="n">ResolvableMagic</span><span class="p">(</span><span class="n">PrinterInterface</span><span class="p">)</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">PrintSomething</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">HelloWorldPrinter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">PrinterInterface</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">PrintSomething</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Hello, world!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Much more readable, isn’t it? It also puts back the focus to what this interface provides: a method that, when called, prints something. Also quite uninspiringly, the <code class="highlighter-rouge">HelloWorldPrinter</code> implementation prints… an hello world :)</p>

<h2 id="the-native-container">The Native Container</h2>

<p>Ok so, at this point we’re able to make <em>resolvable</em> types and interfaces.. but how do we actually <em>resolve</em> them? Where do we ask for the uninspirigly yet awesome <code class="highlighter-rouge">HelloWorldPrinter</code> created above?</p>

<p>The native container has the answer, of course!</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NativeContainer</span>
<span class="p">{</span>
	<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">ClassUniqueId</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ILifetimeManager</span><span class="o">&gt;&gt;</span> <span class="n">m_RegisteredInstances</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>

	<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Interface</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Type</span><span class="p">,</span> <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">LifetimeManager</span><span class="o">&gt;</span>
	<span class="kt">void</span> <span class="n">RegisterType</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">static_assert</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">ILifetimeManager</span><span class="p">,</span> <span class="n">LifetimeManager</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;&gt;::</span><span class="n">value</span><span class="p">),</span> 
			<span class="s">"The LifetimeManager class must derive from ILifetimeManager"</span><span class="p">);</span>
		<span class="k">static_assert</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">IResolvableType</span><span class="p">,</span> <span class="n">Interface</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">),</span> 
			<span class="s">"The interface you are trying to register must derive from IResolvableType"</span><span class="p">);</span>
		<span class="k">static_assert</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">Interface</span><span class="p">,</span> <span class="n">Type</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">),</span> 
			<span class="s">"The type you are trying to register must derive from the interface you provided as Interface"</span><span class="p">);</span>

		<span class="k">auto</span> <span class="n">lifetimeManager</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">LifetimeManager</span><span class="o">&lt;</span><span class="n">Type</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">();</span>
		<span class="n">m_RegisteredInstances</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">Interface</span><span class="o">::</span><span class="n">GetStaticTypeId</span><span class="p">(),</span> <span class="n">lifetimeManager</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Interface</span><span class="o">&gt;</span>
	<span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Interface</span><span class="o">&gt;</span> <span class="n">Resolve</span><span class="p">()</span> <span class="k">const</span>
	<span class="p">{</span>
		<span class="k">static_assert</span><span class="p">((</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">IResolvableType</span><span class="p">,</span> <span class="n">Interface</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">),</span> 
			<span class="s">"The interface you are trying to register must derive from IResolvableType"</span><span class="p">);</span>

		<span class="k">const</span> <span class="k">auto</span> <span class="n">kManager</span> <span class="o">=</span> <span class="n">m_RegisteredInstances</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">Interface</span><span class="o">::</span><span class="n">GetStaticTypeId</span><span class="p">());</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">kManager</span> <span class="o">==</span> <span class="n">m_RegisteredInstances</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">{};</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">kManager</span><span class="o">-&gt;</span><span class="n">second</span><span class="o">-&gt;</span><span class="n">GetInstance</span><span class="o">&lt;</span><span class="n">Interface</span><span class="o">&gt;</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>I’m asking you, the reader, a little bit of faith at this point. The container is not that complex if you skip through the static checks. It simply declares two methods, one that is used to register types and interfaces; the other one to retrieve (or <em>resolve</em>) a type’s instance.</p>

<p>The reason why this class is so simple is that it does not actually create instances. The <code class="highlighter-rouge">RegisterType</code> method just writes a pair inside a map, linking together the interface’s unique identifier with an object, the <em>lifetime manager</em>.</p>

<p>We’re not going to see how these managers are created or what they do at this time, hence the leap of faith I’ve asked you before: it would make this article too long. But as can be easily deduced from the above code, when it’s invoked in the <code class="highlighter-rouge">Resolve</code> method, it just returns an instance of the type it was declared with (it’s a templated class!).</p>

<h2 id="conclusions">Conclusions</h2>

<p>With a bit of templated magic, I was able to pull off this (simple and limited) container. It represents a good starting point for further research: for example, these kinds of containers are usually able to resolve dependencies a type might have to work properly.</p>

<p>An RSS reader might depend on some kind of download service; a class might need a logger service to support debugging. My implementation doesn’t support dependency resolution but it could be easily implemented if the type exposed a list of unique identifiers for each dependency, along with storage for the resolved instances… so that the container, before returning the type’s instance, might read those IDs, resolve and then inject them in it.</p>

<p>In the next few weeks, I’m planning to write a new post to talk about the lifetime managers we’ve seen above. It’ll be interesting to see how the container offloads object creation in separate classes…</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/mmischitelli.png" alt="mmischitelli" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/mmischitelli">Michele Mischitelli</a></h4>
                                
                                    <p>C++ & Unreal Engine 4 developer</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/mmischitelli">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Michele Mischitelli's blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/cpp/">Cpp</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/2020/11/28/first-game-in-ue4/">Our first game using UE4 and C++</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/2019/11/14/lifetime-managers/">Lifetime managers</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/2019/11/07/delegates-async-subsystems/">UE4 - delegates, async and subsystems</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/cpp/">
                                
                                    See all 6 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/2019/10/10/introduction-to-ue4/">
                <div class="post-card-image" style="background-image: url(/assets/images/posts/introduction-to-ue4.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/2019/10/10/introduction-to-ue4/">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Ue4, </span>
                            
                        
                            
                               <span class="post-card-tags">Cpp, </span>
                            
                        
                            
                                <span class="post-card-tags">Talks</span>
                            
                        
                    

                    <h2 class="post-card-title">Introduction to Unreal Engine 4</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/mmischitelli.png" alt="Michele Mischitelli" />
                        
                        <span class="post-card-author">
                            <a href="/author/mmischitelli/">Michele Mischitelli</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/2019/07/17/automatic-commands/">
                <div class="post-card-image" style="background-image: url(/assets/images/posts/automatic-commands.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/2019/07/17/automatic-commands/">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Cpp</span>
                            
                        
                    

                    <h2 class="post-card-title">Automatic commands</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/mmischitelli.png" alt="Michele Mischitelli" />
                        
                        <span class="post-card-author">
                            <a href="/author/mmischitelli/">Michele Mischitelli</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/">
            
                <img src="/assets/images/favicon.png" alt="Michele Mischitelli's blog icon" />
            
            <span>Michele Mischitelli's blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Simple C++ Container</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Simple+C%2B%2B+Container&amp;url=https://mmischitelli.github.io2019/10/06/simple-container/"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://mmischitelli.github.io2019/10/06/simple-container/"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">Michele Mischitelli's blog</a> &copy; 2020</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    <a href="https://twitter.com/michelemischit1" target="_blank" rel="noopener">Twitter</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51694480-3', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
